---
title: å‹å˜ Variance
---
# å‹å˜ Variance

å¯¹äºç®€å•ç±»å‹ `Base` å’Œ `Child`ï¼Œå¦‚æœ `Child` æ˜¯ `Base` çš„å­ç±»ï¼Œé‚£ä¹ˆ `Child` çš„å®ä¾‹å¯ä»¥èµ‹å€¼ç»™ `Base` ç±»å‹çš„å˜é‡ã€‚è¿™å°±æ˜¯å¤šæ€çš„åŸºæœ¬æ¦‚å¿µã€‚

åœ¨ç”± `Base` å’Œ `Child` ç»„æˆçš„å¤æ‚ç±»å‹ä¸­ï¼Œå…¶å…¼å®¹æ€§å–å†³äº `Base` å’Œ `Child` åœ¨ç±»ä¼¼åœºæ™¯ä¸­çš„ä½ç½®ï¼Œè€Œè¿™ç§è¡Œä¸ºç”±**å‹å˜**å†³å®šã€‚

- **åå˜ï¼ˆCovariantï¼‰**ï¼š(`co`ï¼Œå³â€œå…±åŒâ€) â€”â€” åªèƒ½ä¿æŒç›¸åŒæ–¹å‘ã€‚
- **é€†å˜ï¼ˆContravariantï¼‰**ï¼š(`contra`ï¼Œå³â€œç›¸åâ€) â€”â€” åªèƒ½ä¿æŒç›¸åæ–¹å‘ã€‚
- **åŒå˜ï¼ˆBivariantï¼‰**ï¼š(`bi`ï¼Œå³â€œä¸¤è€…çš†å¯â€) â€”â€” æ—¢å¯ä»¥åå˜ä¹Ÿå¯ä»¥é€†å˜ã€‚
- **ä¸å˜ï¼ˆInvariantï¼‰**ï¼šå¦‚æœç±»å‹ä¸å®Œå…¨ç›¸åŒï¼Œåˆ™å®ƒä»¬æ˜¯ä¸å…¼å®¹çš„ã€‚

## ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜

æˆ‘ä»¬ä»¥æ›´ä¸ºå…·ä½“çš„ä¾‹å­æ¥ç†è§£ï¼Œå‡è®¾æœ‰å¦‚ä¸‹ä¸‰ç§ç±»å‹ï¼š

> `Greyhound â‰¼ Dog â‰¼ Animal`

`Greyhound`Â ï¼ˆç°ç‹—ï¼‰æ˜¯Â `Dog`Â ï¼ˆç‹—ï¼‰çš„å­ç±»å‹ï¼Œè€ŒÂ `Dog`Â åˆ™æ˜¯Â `Animal`Â ï¼ˆåŠ¨ç‰©ï¼‰çš„å­ç±»å‹ã€‚ç”±äºå­ç±»å‹é€šå¸¸æ˜¯å¯ä¼ é€’çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿç§°Â `Greyhound`Â æ˜¯Â `Animal`Â çš„å­ç±»å‹ã€‚

**é—®é¢˜**ï¼šä»¥ä¸‹å“ªç§ç±»å‹æ˜¯Â `Dog â†’ Dog`Â çš„å­ç±»å‹å‘¢ï¼Ÿ

1. `Greyhound â†’ Greyhound`
2. `Greyhound â†’ Animal`
3. `Animal â†’ Animal`
4. `Animal â†’ Greyhound`

è®©æˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸‹å¦‚ä½•è§£ç­”è¿™ä¸ªé—®é¢˜ã€‚é¦–å…ˆæˆ‘ä»¬å‡è®¾Â `f`Â æ˜¯ä¸€ä¸ªä»¥Â `Dog â†’ Dog`Â ä¸ºå‚æ•°çš„å‡½æ•°ã€‚å®ƒçš„è¿”å›å€¼å¹¶ä¸é‡è¦ï¼Œä¸ºäº†å…·ä½“æè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å‡è®¾å‡½æ•°ç»“æ„ä½“æ˜¯è¿™æ ·çš„ï¼šÂ `f : (Dog â†’ Dog) â†’ String`ã€‚

ç°åœ¨æˆ‘æƒ³ç»™å‡½æ•°Â `f`Â ä¼ å…¥æŸä¸ªå‡½æ•°Â `g`Â æ¥è°ƒç”¨ã€‚æˆ‘ä»¬æ¥ç§ç§å½“Â `g`Â ä¸ºä»¥ä¸Šå››ç§ç±»å‹æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚

**1. æˆ‘ä»¬å‡è®¾Â `g : Greyhound â†’ Greyhound`ï¼ŒÂ `f(g)`Â çš„ç±»å‹æ˜¯å¦å®‰å…¨ï¼Ÿ**

ä¸å®‰å…¨ï¼Œå› ä¸ºåœ¨ f å†…è°ƒç”¨å®ƒçš„å‚æ•°`(g)`å‡½æ•°æ—¶ï¼Œä½¿ç”¨çš„å‚æ•°å¯èƒ½æ˜¯ä¸€ä¸ªä¸åŒäºç°ç‹—ä½†åˆæ˜¯ç‹—çš„å­ç±»å‹ï¼Œä¾‹å¦‚Â `GermanShepherd`Â ï¼ˆç‰§ç¾ŠçŠ¬ï¼‰ã€‚

**2. æˆ‘ä»¬å‡è®¾Â `g : Greyhound â†’ Animal`ï¼ŒÂ `f(g)`Â çš„ç±»å‹æ˜¯å¦å®‰å…¨ï¼Ÿ**

ä¸å®‰å…¨ã€‚ç†ç”±åŒ(1)ã€‚

**3. æˆ‘ä»¬å‡è®¾Â `g : Animal â†’ Animal`ï¼ŒÂ `f(g)`Â çš„ç±»å‹æ˜¯å¦å®‰å…¨ï¼Ÿ**

ä¸å®‰å…¨ã€‚å› ä¸ºÂ `f`Â æœ‰å¯èƒ½åœ¨è°ƒç”¨å®Œå‚æ•°ä¹‹åï¼Œè®©è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯Â `Animal`Â ï¼ˆåŠ¨ç‰©ï¼‰ç‹—å«ã€‚å¹¶éæ‰€æœ‰åŠ¨ç‰©éƒ½ä¼šç‹—å«ã€‚

**4. æˆ‘ä»¬å‡è®¾Â `g : Animal â†’ Greyhound`ï¼ŒÂ `f(g)`Â çš„ç±»å‹æ˜¯å¦å®‰å…¨ï¼Ÿ**

æ˜¯çš„ï¼Œå®ƒçš„ç±»å‹æ˜¯å®‰å…¨çš„ã€‚é¦–å…ˆï¼Œ`f`Â å¯èƒ½ä¼šä»¥ä»»ä½•ç‹—çš„å“ç§æ¥ä½œä¸ºå‚æ•°è°ƒç”¨ï¼Œè€Œæ‰€æœ‰çš„ç‹—éƒ½æ˜¯åŠ¨ç‰©ã€‚å…¶æ¬¡ï¼Œå®ƒå¯èƒ½ä¼šå‡è®¾ç»“æœæ˜¯ä¸€æ¡ç‹—ï¼Œè€Œæ‰€æœ‰çš„ç°ç‹—éƒ½æ˜¯ç‹—ã€‚

å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼š

> `(Animal â†’ Greyhound) â‰¼ (Dog â†’ Dog)`

è¿”å›å€¼ç±»å‹å¾ˆå®¹æ˜“ç†è§£ï¼šç°ç‹—æ˜¯ç‹—çš„å­ç±»å‹ã€‚ä½†å‚æ•°ç±»å‹åˆ™æ˜¯ç›¸åçš„ï¼šåŠ¨ç‰©æ˜¯ç‹—çš„**çˆ¶ç±»**ï¼

ç±»å‹å®‰å…¨æ„å‘³ç€ä¸€ä¸ªå‡½æ•°ç±»å‹ä¸­ï¼Œè¿”å›å€¼ç±»å‹æ˜¯**åå˜**çš„ï¼Œè€Œå‚æ•°ç±»å‹æ˜¯**é€†å˜**çš„ï¼š

+ è¿”å›å€¼ç±»å‹æ˜¯åå˜çš„ï¼Œæ„æ€æ˜¯Â `A â‰¼ B`Â å°±æ„å‘³ç€Â `(T â†’ A) â‰¼ (T â†’ B)`Â ã€‚
+ å‚æ•°ç±»å‹æ˜¯é€†å˜çš„ï¼Œæ„æ€æ˜¯Â `A â‰¼ B`Â å°±æ„å‘³ç€Â `(B â†’ T) â‰¼ (A â†’ T)`


## åå˜ Covariant

 **å¦‚æœ `Child` æ˜¯ `Base` çš„å­ç±»ï¼Œé‚£ä¹ˆ `Container<Child>` ä¹Ÿå¯ä»¥è¢«è§†ä¸º `Container<Base>`ï¼ˆå­ç±»å‹å¯ä»¥èµ‹å€¼ç»™çˆ¶ç±»å‹çš„å®¹å™¨ï¼‰**

âœ… **ç¤ºä¾‹ï¼ˆåå˜çš„æ³›å‹ï¼‰ï¼š**

```typescript
class Base {}
class Child extends Base {}

class CovariantContainer<out T> {}  // out ä»£è¡¨ T åªèƒ½å‡ºç°åœ¨è¾“å‡ºä½ç½®ï¼ˆè¿”å›å€¼ï¼‰

let baseContainer: CovariantContainer<Base>;
let childContainer: CovariantContainer<Child>;

// å…è®¸ï¼šå­ç±»çš„å®¹å™¨å¯ä»¥èµ‹å€¼ç»™çˆ¶ç±»çš„å®¹å™¨
baseContainer = childContainer;
```

ğŸ”¹ **é€‚ç”¨åœºæ™¯ï¼š** **"è¯»å–æ•°æ®" çš„å®¹å™¨**ï¼ˆå¦‚ `List<T>` åœ¨ Kotlinã€C# ä¸­æ˜¯åå˜çš„ï¼‰ã€‚  

**åŸå› ï¼š** åªå…è®¸ `T` å‡ºç°åœ¨ **è¾“å‡ºä½ç½®ï¼ˆè¿”å›å€¼ï¼‰**ï¼Œä¸ä¼šæ¶‰åŠå†™å…¥ `Base` æˆ– `Child` çš„æƒ…å†µï¼Œå› æ­¤ä¸ä¼šç ´åç±»å‹å®‰å…¨ã€‚

## é€†å˜ Contravariant

**å¦‚æœ `Child` æ˜¯ `Base` çš„å­ç±»ï¼Œé‚£ä¹ˆ `Processor<Base>` ä¹Ÿå¯ä»¥è¢«è§†ä¸º `Processor<Child>`ï¼ˆçˆ¶ç±»å‹çš„å¤„ç†å™¨å¯ä»¥ç”¨äºå­ç±»å‹ï¼‰ã€‚**

âœ… **ç¤ºä¾‹ï¼ˆé€†å˜çš„æ³›å‹ï¼‰ï¼š**

```typescript
class Processor<in T> {  // in ä»£è¡¨ T åªèƒ½å‡ºç°åœ¨è¾“å…¥ä½ç½®ï¼ˆå‚æ•°ï¼‰
  process(item: T) {
    console.log("Processing", item);
  }
}

let baseProcessor: Processor<Base> = new Processor<Base>();
let childProcessor: Processor<Child> = new Processor<Child>();

// å…è®¸ï¼šçˆ¶ç±»çš„å¤„ç†å™¨å¯ä»¥èµ‹å€¼ç»™å­ç±»çš„å¤„ç†å™¨
childProcessor = baseProcessor;
```

ğŸ”¹ **é€‚ç”¨åœºæ™¯ï¼š** **"å¤„ç†è¾“å…¥" çš„å¯¹è±¡**ï¼ˆå¦‚ `Comparator<T>` åœ¨ Java ä¸­æ˜¯é€†å˜çš„ï¼‰ã€‚  

**åŸå› ï¼š** åªå…è®¸ `T` å‡ºç°åœ¨ **è¾“å…¥ä½ç½®ï¼ˆå‚æ•°ï¼‰**ï¼Œä¸ä¼šäº§ç”Ÿä¸å…¼å®¹çš„è¿”å›å€¼ï¼Œå› æ­¤ä¸ä¼šç ´åç±»å‹å®‰å…¨ã€‚

## åŒå˜ Bivariant

**`Container<Child>` æ—¢èƒ½èµ‹å€¼ç»™ `Container<Base>`ï¼Œä¹Ÿèƒ½åè¿‡æ¥èµ‹å€¼ï¼ˆå‡ ä¹æ‰€æœ‰æ–¹å‘çš„èµ‹å€¼éƒ½å¯ä»¥ï¼Œä½†è¿™é€šå¸¸æ˜¯ä¸å®‰å…¨çš„ï¼‰ã€‚**

âœ… **ç¤ºä¾‹ï¼ˆTypeScript é‡Œå‡½æ•°å‚æ•°é»˜è®¤æ˜¯åŒå˜çš„ï¼‰ï¼š**

```typescript
class BivariantContainer<T> {}

let baseBivariant: BivariantContainer<Base>;
let childBivariant: BivariantContainer<Child>;

// å…è®¸ï¼šä»»æ„æ–¹å‘çš„èµ‹å€¼
baseBivariant = childBivariant;
childBivariant = baseBivariant;
```

ğŸ”¹ **é€‚ç”¨åœºæ™¯ï¼š** **å‡ ä¹æ²¡æœ‰çœŸå®éœ€è¦ç”¨åˆ°åŒå˜çš„æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸å®‰å…¨çš„ï¼**  
**åŸå› ï¼š** å…è®¸ç±»å‹è‡ªç”±è½¬æ¢ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç±»å‹é”™è¯¯ï¼Œå› æ­¤å¤§å¤šæ•°è¯­è¨€ä¸ä¼šå…è®¸æ³›å‹å‚æ•°æ˜¯åŒå˜çš„ã€‚

## ä¸å˜ Invariant

**`Container<Base>` å’Œ `Container<Child>` äº’ä¸å…¼å®¹ï¼Œä¸èƒ½ç›¸äº’èµ‹å€¼ã€‚**

ğŸš« **ç¤ºä¾‹ï¼ˆä¸å˜çš„æ³›å‹ï¼‰ï¼š**

```typescript
class InvariantContainer<T> {}

let baseInvariant: InvariantContainer<Base> = new InvariantContainer<Base>();
let childInvariant: InvariantContainer<Child> = new InvariantContainer<Child>();

// âŒ ä¸å…è®¸ï¼šä¸èƒ½æŠŠå­ç±»çš„å®¹å™¨èµ‹å€¼ç»™çˆ¶ç±»çš„å®¹å™¨
// baseInvariant = childInvariant;  // Type Error!

// âŒ ä¹Ÿä¸å…è®¸åå‘èµ‹å€¼
// childInvariant = baseInvariant;  // Type Error!
```

ğŸ”¹ **é€‚ç”¨åœºæ™¯ï¼š** **éœ€è¦"æ—¢èƒ½è¯»å–ä¹Ÿèƒ½å†™å…¥"çš„å®¹å™¨**ï¼ˆå¦‚ Java çš„ `ArrayList<T>` æ˜¯ä¸å˜çš„ï¼‰ã€‚  

**åŸå› ï¼š** å…è®¸ `T` æ—¢å‡ºç°åœ¨è¾“å…¥ä½ç½®ï¼ˆå†™å…¥ï¼‰åˆå‡ºç°åœ¨è¾“å‡ºä½ç½®ï¼ˆè¯»å–ï¼‰ï¼Œå¦‚æœç±»å‹ä¸ä¸¥æ ¼åŒ¹é…ï¼Œå°±å¯èƒ½å¯¼è‡´ç±»å‹é”™è¯¯ã€‚