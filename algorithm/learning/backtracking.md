---
title: 回溯算法
---
## 概述

回溯算法是一种强大的问题解决技术，它通过**系统性地搜索所有可能解**来解决问题。

回溯法的本质，其实就是**优化过的暴力搜索**：

- **试错思想**：尝试所有可能路径
- **状态管理**：记录当前选择路径
- **回溯机制**：当路径无效或完成时撤销选择
- **剪枝优化**：跳过无效分支提高效率

## 与相关算法对比

| 算法类型 | 目标      | 状态管理          | 适用问题        |
| :------- | :-------- | :---------------- | :-------------- |
| 回溯     | 找所有解  | 显式状态记录+撤销 | 组合/排列/子集  |
| DFS      | 遍历图/树 | 仅标记访问        | 连通性/路径查找 |
| BFS      | 最短路径  | 队列存储状态      | 最短路径问题    |
| DP       | 最优解    | 状态转移方程      | 最优化问题      |

## 算法框架（万能模板）

```js
function backtrack(路径, 选择列表) {
    // 1. 终止条件：找到有效解
    if (满足结束条件) {
        结果集.push(路径副本); // 深拷贝
        return;
    }
    
    // 2. 遍历所有选择
    for (选择 of 选择列表) {
        // 3. 剪枝：跳过无效选择
        if (选择无效) continue;
        
        // 4. 做选择
        将选择加入路径;
        更新状态标记;
        
        // 5. 递归探索
        backtrack(新路径, 新选择列表);
        
        // 6. 撤销选择（回溯）
        从路径移除选择;
        恢复状态标记;
    }
}
```

## 算法四要素

### 1. 解空间结构

- **树形结构**：决策过程形成状态空间树
- **节点**：当前决策状态
- **边**：做出的选择
- **叶子节点**：完整解

```
示例：排列问题[1,2]的状态空间树
        []
       /  \
      1    2
     /      \
    [1]     [2]
     |       |
   [1,2]   [2,1]
```

### 2. 剪枝策略（关键优化）

- **约束剪枝**：跳过不满足约束的选择
- **限界剪枝**：跳过不可能成为最优解的分支
- **重复剪枝**：避免生成重复解

```js
// 排列问题剪枝示例
if (used[i]) continue; // 约束剪枝：跳过已用元素

// 组合问题剪枝示例（避免重复组合）
if (start > i) continue; // 限界剪枝：只考虑升序排列
```

### 3. 状态管理

- **路径状态**：当前选择序列
- **辅助状态**：记录决策相关信息
- **状态撤销**：递归返回时恢复状态

### 4. 终止条件

- 找到完整解（路径长度 = 目标长度）
- 无更多选择
- 达到问题特定条件

## 经典问题类型与解法

### 1. 排列问题（Permutations）

- **特点**：顺序敏感，所有元素参与
- **代表题目**：[[46|全排列（LeetCode 46）]]
- **关键点**：使用`used`数组避免重复选择

### 2. 组合问题（Combinations）

- **特点**：顺序无关，元素子集
- **代表题目**：[[39|组合总和（LeetCode 39）]]
- **关键点**：`start`参数避免重复组合

### 3. 子集问题（Subsets）

- **特点**：所有可能子集
- **代表题目**：[[78|子集（LeetCode 78）]]
- **关键点**：每个节点都是有效解

### 4. 约束满足问题

- **代表题目**：
  - N皇后（LeetCode 51）
  - 数独（LeetCode 37）
- **关键点**：复杂约束检查

## 复杂度分析

| 问题类型 | 时间复杂度 | 空间复杂度 |
| :------- | :--------- | :--------- |
| 排列问题 | O(n×n!)    | O(n)       |
| 组合问题 | O(n×2ⁿ)    | O(n)       |
| 子集问题 | O(n×2ⁿ)    | O(n)       |
| N皇后    | O(n!)      | O(n)       |
