## 为什么要读源码

语言只是一个工具，关键还是需要利用自己的思想，解决问题;

不过相对于背那些八股文，我感觉通读这个领域的源码，了解各种优秀的思想，才能真正带来技术上的进步，这也是进阶必不可少的一步。

在我们未有足够经验的时候，去了解一个未知的框架，都感觉是庞然大物，不可触及。但其实遵循一定的方法，层层抽丝剥茧，就可以慢慢发现作者很多精妙的想法，甚至彩蛋，这也是读别人源码能带来的乐趣。

### 问题驱动——不要为了看源码而看源码

首先我们要明确一点，看源码的目的是什么？

不要为了面试需要读而读，不然适得其反，枯燥无味，浪费时间，不知所言，还不如多看别人源码分析文章来得快。

## 怎样去读源码

**带着问题去看源码**，比如想了解一下 React 的合成事件系统的原理，想了解 React 的 setState 前后发生了什么，或者想了解 Webpack 插件系统的原理。也有可能是遇到了一个 bug，怀疑是框架/工具的问题。在这样的情况下，带着一个具体的目标去看源码，就会有的放矢。

### 应用文档

不要着急直接去拉仓库代码来看，如果这个框架有相关应用文档的，先耐心看完整个应用文档，而且要看原版，如果是英语的，尽量不要找翻译的版本，因为时效性和准确性问题，可能会让你走了弯路。

结合文档以及一些博客技术文章，可在看源码之前对项目的**原理**有一个基本的了解。所谓原理就是，这个项目有哪些组成部分，为了达到最终的产出，要经过哪几步流程。这些流程里，业界主流的方案有哪几种。

### package.json配置字段

+ dependencies：项目生产依赖，代表项目被应用时候，必须依赖的其他包

+ devDependencies：项目开发依赖，代表项目在开发时候，必须依赖的其他包

+ peerDependencies：项目对等依赖，代表项目在运行时候，必须依赖外部项目本身安装的依赖，而不是自身内部的依赖
+ main：commonJS规范下（使用require引用）指定入口，如果不指定，会默认引用根目录下index.js
+ module：ESM规范下（使用import引用）指定入口；
+ browser：浏览器运行环境的模块引用入口，main和module不区分运行环境
+ files：指定npm包发布的文件列表，例如指定构建后的文件列表，源码不发布
+ workspaces：配置工作区，例如你开发的是一个大框架，包含很多子package，则将子package路径配置到工作区里，而将这个大框架的private设置为true，因为这个大框架不是你要发布的包
+ bin：配置自定义命令，键值将被注册为快捷脚本，对应文件入口为命令执行文件，基本脚手架都会用到这个

### 本地运行

看源码的第一步就是把项目的代码仓库 clone 到本地。然后按项目 README 或者 CONTRIBUTING 上的构建指南，在本地 build 一下。

从源码入口文件开始，逐步去debug整个源码逻辑结构，可以先看函数定义和引用，再附加过程中的各项注释，形成自己的笔记文档。

+ 如果是前端框架，我们可以在 HTML 中里直接引入本地 build 出的 `umd bundle`（记得用 development build，不然会把代码压缩，可读性差），然后写一个简单的 demo，demo 里引入本地的 build；

+ 如果是基于 Nodejs 的工具，我们可以用 `npm link` 把这个工具的命令 link 到本地。也可以直接看项目的 package.json 的入口文件，直接用 node 运行那个文件；

以 React 为例，React 的 [Contributing Guide](https://link.juejin.cn/?target=https%3A%2F%2Freactjs.org%2Fdocs%2Fhow-to-contribute.html) 里就 Development Workflow 这一节；

### 目录结构

看具体的代码之前，我们需要理清项目的目录结构，这样我们才能更快的知道在哪里地方找相关功能的代码。

例如 React 的目录结构。React 是一个 monorepo。也就是一个仓库里包含了多个子仓库。我们在 packages 目录下可以看到很多单独的 package；

在 React 16 之后，React 的代码分为 React Core，Renderer 和 Reconciler 三部分。

这是因为 React 的设计让我们可以把负责映射数据到 UI 的 Reconciler 以及负责渲染 Vritual DOM 到各个终端的 Renderer 和 React Core 分开。React Core 包含了 React 的类定义和一些顶级 API。

大部分的渲染和 View 层 diff 的逻辑都在 Reconciler 和 Renderer 中；

---

如果这个项目是一个 monorepo，首先我们要找到核心的那个 package，然后看里面的代码。

不是 monorepo 的话，一般来说：

+ 如果这个项目是一个 CLI 的工具，那 bin 目录下放的就是命令行界面相关的入口文件，lib 或者 src 下面就是工具的核心代码；
+ 如果这个项目是一个前端 View 层框架，那目录结构就和 Vue 类似；

### 调试方法

+ 使用断点，全局搜索，查看调用栈



+ [阅读前端源码的思路 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/463112753)
+ [如何阅读大型前端开源项目的源码 - 掘金 (juejin.cn)](https://juejin.cn/post/6844903607393845255)
