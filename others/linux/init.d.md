## /etc/init.d 目录

目录 */etc/init.d/* 中包含许多系统服务的启动和停止脚本，除了该文件还有许多 `rc#.d` 形式存在的目录（这里 **#** 代表一个指定的初始化级别，范围是0~6）。在这些目录之下，包含了许多对进程进行控制的脚本。

> 以 System V init 或者 Upstart 为初始化系统的 Linux 讨论目录 /etc/init.d/ 才有意义

在这些目录之下，包含了许多对进程进行控制的脚本。这些脚本要么以“K”开头，要么以“S”开头。以“K”开头的脚本运行在以“S”开头的脚本之前。

使用 *init.d* 目录下的脚本，需要有 root 权限。每个脚本都将被作为一个命令运行，该命令的结构大致如下：

```bash
/etc/init.d/<command> <start|stop|reload|restart>
```

目录 */etc/rcN.d* 是符号链接文件，实际上是链接到目录 */etc/init.d*，可通过以下命令验证：

```bash
$ ll /etc/rc1.d
```

Linux 的每个运行级别，在 `/etc` 都有一个子目录分别是 rc0.d，rc1.d …… rc6.d，但是这些目录下的脚本都实际存放在  */etc/init.d* 中，只是通过链接进行了级别的划分。

这些符号链接的名称通常遵循 `[S|K]XXname` 的命名约定。在这里，`S` 表示要启动服务，K则表示停止服务，`XX` 是一个数字，表示执行顺序，`name` 是服务名称。

当系统启动时，系统启动脚本将按照字母顺序执行 `/etc/rc*.d` 目录中的所有启动脚本符号链接，这将自动传递 `start` 命令参数，以便启动系统服务；当系统关机或重启时，则自动传递 `stop` 命令参数，停止系统服务。

### Ubuntu中的运行级别

- 0（关闭系统）
- 1（单用户模式，只允许root用户对系统进行维护。）
- 2 到 5（多用户模式，其中3为字符界面，5为图形界面。）
- 6（重启系统）

可以通过命令 `runlevel`，来获取当前系统运行的级别。

## update-rc.d 命令

Ubuntu 或者 Debian 系统中`update-rc.d`命令，是用来更新系统启动项的脚本。这些脚本的链接位于`/etc/rcN.d/`目录，对应脚本位于/etc/init.d/目录。

### linux 系统主要启动步骤

1. 读取 MBR 的信息，启动 Boot Manager。
2. 加载系统内核，启动 init 进程， init 进程是 Linux 的根进程，所有的系统进程都是它的子进程。
3. init 进程读取 */etc/inittab* 文件中的信息，并进入预设的运行级别。通常情况下 */etc/rcS.d/* 目录下的启动脚本首先被执行，然后是*/etc/rcN.d/* 目录。
4. 根据 */etc/rcS.d/* 文件夹中对应的脚本启动 `Xwindow` 服务器 `xorg`，`Xwindow` 为 Linux 下的图形用户界面系统。
   启动登录管理器，等待用户登录。

创建一个启动脚本后，可以将其链接或直接放置到*/etc/init.d* 中，例如一个 ‘pm2`的服务，然后执行命令：

```bash
sudo update-rc.d pm2 defaults
```

则会为该服务创建一个启动符号链接（symbolic link）到系统各个不同级别的启动目录，也可以进行手动创建。
