## 概述

**Zip Bomb（ZIP炸弹）** 是一种特殊的恶意文件，它通过压缩技术实现极度高效的“数据压缩”，目的是让解压操作消耗巨大的计算资源，甚至导致目标系统崩溃。简单来说，**Zip Bomb 是一种利用压缩
文件的反常行为，导致目标计算机在解压时过载的恶意文件**。

## 工作原理

- **创建高度压缩的文件：** Zip Bomb 使用压缩算法（如 ZIP、RAR 等）将大量的文件或数据压缩成一个非常小的文件。理论上，压缩的过程应该减少数据的大小，但 Zip Bomb 特别设计成能够在解压后产生一个异常大的文件。
- **大文件膨胀：** 当 Zip Bomb 被解压时，它会爆炸性地扩展成一个极大的文件。例如，一个 50 KB 的 Zip Bomb 文件可能会解压成几 TB 的大文件。这样，解压过程会消耗大量的存储空间和 CPU 资源。
- **计算资源消耗：** 由于 Zip Bomb 通常包含大量重复的数据，通过压缩方式将这些数据变得高度紧凑，解压时需要消耗大量的计算资源（尤其是 CPU 和内存）。在没有足够资源的情况下，解压过程可能会导致目标计算机：
    - 系统崩溃或死机
    - 网络带宽耗尽
    - 存储空间耗尽
    - 服务器过载

## 典型示例

一个经典的 Zip Bomb 文件，如 *"42.zip"*，其文件大小为 42 KB，但解压后可以扩展到 **4.5 PB**，这个压缩比接近 1:45,000,000,000。

- Zip Bomb 通常是一个包含非常大量数据的 Zip 文件。它们可能包含多级压缩，或者是具有非常多重复数据的文件，这样即使压缩包很小，解压时也能产生极大数据膨胀。
- **例如**，一个包含很多嵌套压缩文件的 Zip Bomb 文件，可能先解压为一个文件，再解压为另一个压缩文件，最终导致极大的数据膨胀。

## 用途和危害

1. **拒绝服务攻击（DoS）：** Zip Bomb 的最常见用途是拒绝服务攻击（Denial of Service，DoS）。攻击者可以利用 Zip Bomb 文件发送到目标系统，通过消耗大量计算资源、存储空间或网络带宽，导致目标系统的服务中断或崩溃。
2. **绕过安全防护：** Zip Bomb 也可以被用来绕过安全软件的扫描。因为 Zip Bomb 文件本身非常小，传统的反病毒软件或邮件安全网关可能无法识别其恶意性质。当解压时才会出现问题，给安全防护带来挑战。
3. **资源消耗：** 一旦 Zip Bomb 文件被解压，它会占用大量的系统资源，这可能导致：
    - 计算机性能急剧下降
    - 系统死机或崩溃
    - 数据丢失或系统不稳定
4. **可能的物理损坏：** 如果目标设备没有足够的资源或防护，Zip Bomb 可能会造成硬盘损坏，因为它会导致设备反复写入大量数据，甚至可能导致硬盘空间耗尽。

## 实战演练

为防范恶意访问爬虫机器人，可采用  Zip Bomb 的方法进行防范：

>参考：[I use Zip Bombs to Protect my Server](https://idiallo.com/blog/zipbomb-protection)
### 创建压缩文件

```bash
dd if=/dev/zero bs=1G count=10 | gzip -c > 10GB.gz
```

- `dd if=/dev/zero bs=1G count=10`：使用 `dd` 命令从 `/dev/zero` 设备生成 10 个 1GB 的零字节块，总共 10GB 的数据流。`/dev/zero` 是一个特殊的设备，生成无限数量的零字节数据。
- `| gzip -c`： 将生成的零字节数据通过管道传输给 `gzip`，并将其压缩。`-c` 选项表示将输出结果写到标准输出。
- `> 10GB.gz`：最终将压缩后的数据输出到 `10GB.gz` 文件中。

### 服务器中间件配置

```php
if (ipIsBlackListed() || isMalicious()) {
    header("Content-Encoding: deflate, gzip");
    header("Content-Length: " . filesize(ZIP_BOMB_FILE_10G)); // 10 MB
    readfile(ZIP_BOMB_FILE_10G);
    exit;
}
```

如上是一个 PHP 中间件的示例，目的是在检测到恶意请求时（比如请求来自黑名单 IP 或被检测为恶意的请求），响应一个恶意的文件——**Zip Bomb**。

在 Nginx 服务器中，可使用 `geo` 和 `map` 模块，来实现对恶意请求的拦截和处理：

```nginx
```

