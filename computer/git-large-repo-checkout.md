# 开源项目 supabase 的自部署命令小记

```bash
git clone --filter=blob:none --no-checkout https://github.com/supabase/supabase
git sparse-checkout set --cone docker && git checkout master
```

在自部署 supabase 时，看到了如上的 git 命令，还没有接触使用过，有点陌生，查阅文档后，再次小结一下。

第一行：
- **`--filter=blob:none`**:
    - 这个参数是 Git 2.26 引入的，启用了 Git 的 **partial clone** 功能。它通过过滤掉文件（blob）的内容来克隆仓库，仅克隆必要的对象。
    - `--filter=blob:none` 表示在克隆时不获取文件内容（即 blob 对象）。这意味着你只会获取仓库的元数据（例如，提交记录、分支、标签等），而不下载实际的文件内容。
    - 这种方式可以大大减少克隆仓库时的下载量，尤其是对于大规模的仓库，适用于需要快速克隆仓库并在后续需要时按需获取文件的场景。
- **`--no-checkout`**:
    - 这个参数告诉 Git 在克隆仓库后不立即进行工作区的检出（checkout）。通常，`git clone` 会克隆仓库并将默认分支（如 `main` 或 `master`）检出到工作区，但使用 `--no-checkout` 参数时，Git 仅会下载仓库的元数据，并不会自动将代码文件检出到本地。
    - 使用这个参数的常见场景是，你只关心仓库的元数据，或者打算手动选择分支/提交进行检出，而不是自动检出默认的分支。

第二行：
- `git sparse-checkout` 是 Git 2.25 引入的功能，允许你只检出仓库中的某些部分，而不是整个仓库。这对大型仓库特别有用，因为你可以只获取特定目录的内容，而不需要下载和检出整个仓库。
- `set` 用于设置或更新当前仓库的稀疏检出配置。
- `--cone` 是一种新的方式来指定稀疏检出路径。它是 Git 2.34 引入的，用于更简化和优化稀疏检出的操作。与传统的 `git sparse-checkout set` 命令不同，`--cone` 允许你以更简单的方式配置检出某个目录或路径。
- `docker` 是指定的目录。通过这条命令，Git 会配置稀疏检出，使得只会检出 `docker` 目录下的文件，而忽略其他目录和文件。这样，你的工作区就只会包含该目录的内容，而不会下载或检出仓库中的其他部分。

**简而言之：** `git sparse-checkout set --cone docker` 会让 Git 配置仓库进行稀疏检出，并且只检出 `docker` 目录。

综上所述，这两行命令主要目的如下：
- 克隆仓库时仅获取元数据，避免下载不必要的文件。
- 配置仓库进行稀疏检出，仅工作区包含 `docker` 目录的文件。
- 切换到 `master` 分支，并且只检出 `docker` 目录的内容，避免整个仓库的文件加载。

这种方式适用于只关注仓库中某个子目录（如 `docker`）的场景，并大大减少了仓库的下载和检出量，特别适用于大型仓库。