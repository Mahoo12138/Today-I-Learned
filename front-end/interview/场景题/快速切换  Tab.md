## 问题分析

在做 tab 的切换，一个是已读 tab（展示已读列表）一个是未读的 tab（展示未读列表），每次点击一个 tab 的时候都要去发送HTTP 请求去获取信息，当快速切换按钮的时候会发发生什么问题？



### 竞态条件（Race Condition）

如果使用的是同一个变量展示数据，当用户快速切换 Tab，多个 HTTP 请求会 **同时发送**，但它们的返回顺序 **不一定** 按照请求的顺序。

可能导致数据被覆盖，最终界面展示的内容可能是错误的（用户点击的是 "已读"，却显示了 "未读"）。



### 冗余请求，浪费资源

如果用户 **快速点击 Tab 切换**，每次都会发送新的 HTTP 请求，造成 **大量的冗余请求**，增加服务器负担。

特别是在 **慢网速环境（3G/4G）** 下，未完成的请求可能会堆积，影响性能。



### UI 频闪

如果数据在返回之前 UI 立即更新为空数组：

```tsx
useEffect(() => {
  setList([]);  // 清空数据
  fetchList().then((data) => setList(data));
}, [tab]);
```

可能导致 **短暂的白屏（UI 闪烁）**，影响用户体验。



## 解决方案

1. **取消过时请求**：可以使用 **`AbortController`** 取消 **过时的请求**，避免竞态条件；
2. **只保留最新的请求结果**：标记请求 id **跟踪最新的请求**，只保留最后一次请求的数据；
3. **使用缓存优化**：如果数据不频繁变化，可以 **缓存已获取的数据**，避免重复请求；
4. **请求节流**：使用 SWR / React Query 或手动实现请求函数节流，保证短时间内不发起重复请求。