---
title: 缓存
---
## LRU 缓存（Least Recently Used）

### **概念**

**最近最少使用缓存策略**：淘汰最近最久未被访问的缓存项。

### **原理**

维护一个双向链表或队列，每次访问或写入都将该元素移动到“最近使用端”。当缓存满了，淘汰最久未使用的元素（链表尾部）。

### **数据结构**

- `HashMap<K, Node>`：`O(1)` 查询
- `DoublyLinkedList`：`O(1)` 插入/删除最旧节点

### **优势**

- 简单、直观
- 热数据易于保留

### **劣势**

- 只考虑“时间”，不考虑“频率”
- 频繁访问的一次性数据可能被误保留

### **应用场景**

- 操作系统页缓存
- Redis、Guava、Ehcache 默认缓存策略

## **LFU 缓存（Least Frequently Used）**

### **概念**

**最不常用缓存策略**：淘汰访问频率最低的缓存项。

### **原理**

维护每个元素的访问次数，每次访问增加计数。缓存满时，移除访问频率最低的元素。

### **数据结构**

- `HashMap<K, Node>`：存储缓存项
- `TreeMap<freq, LinkedHashSet<K>>`：按频率维护节点组，支持 `O(1)` 查找最小频率组

### 优势

- 保留“热频数据”，长期访问的数据优先被保留

### **劣势**

- 实现复杂（频率统计+频率组维护）
- 对突发访问数据不够敏感
- 不适合频繁数据突变的场景

### **应用场景**

- 数据库热点查询缓存
- Apache Cassandra、Redis 4.0+ LFU 模式

## **MRU 缓存（Most Recently Used）**

### **概念**

**最近最常用淘汰策略**：淘汰最近刚被访问过的数据。

### **原理**

相反于 LRU。认为最近访问的数据可能是“临时数据”，不再会被访问，优先淘汰它。

### **优势**

- 适用于**周期性数据访问**模式（如扫描、分页）

### **劣势**

- 在大多数使用场景下表现差
- 会误杀热数据

### **应用场景**

- 数据遍历、分析型查询结果缓存
- 特定的内存访问模式优化

## **TTL 缓存（Time To Live）**

### **概念**

**带过期时间的缓存**：每个缓存项都设置一个过期时间，时间一到即删除。

### **原理**

- 每个缓存项附带一个“过期时间戳”
- 查询时如果当前时间大于过期时间，立即淘汰

### **优势**

- 易于实现
- 控制缓存“新鲜度”

### **劣势**

- 不考虑访问频率和最近访问
- 不一定能保证缓存空间控制（需搭配其他策略）

### **应用场景**

- HTTP 缓存（Cache-Control、Expires）
- 分布式缓存（如 Redis 的 EXPIRE）

## **2Q 缓存（Two Queues）**

### **概念**

结合 LRU 与 LFU 的思想，**通过双队列提升命中率，避免一次性访问的数据污染缓存**。

### **核心结构**

- **A1in（短期队列）**：新访问数据先进入此队列（FIFO），缓存空间较小
- **A1out（历史队列）**：记录曾在 A1in 中被淘汰的缓存键
- **Am（长期队列）**：频繁访问的数据转入此队列（LRU）

### **原理**

1. 首次访问的数据进入 A1in。
2. 若 A1in 被淘汰，移入 A1out（只记录键，不存值）。
3. 当某个数据再次被访问，若其在 A1out 中，表明它是“有价值的”，转入 Am。
4. 缓存空间主要在 A1in + Am；A1out 只记录近期淘汰记录。

### **优势**

- 抵抗一次性数据污染（如扫描行为）
- 能在保持 LRU 效率的同时提升缓存命中率

### **劣势**

- 实现复杂
- 对内存空间有一定开销（A1out 存 key）

### **应用场景**

- PostgreSQL Buffer Pool
- 高级 Web 缓存系统
- 数据库与磁盘访问优化

## 整体对比

| 策略    | 核心依据     | 是否考虑频率 | 是否考虑时间 | 抵抗缓存污染 | 实现复杂度 |
| ------- | ------------ | ------------ | ------------ | ------------ | ---------- |
| **LRU** | 最近访问时间 | ✖️            | ✅            | 弱           | 简单       |
| **LFU** | 访问频率     | ✅            | ✖️            | 中           | 较高       |
| **MRU** | 反向时间     | ✖️            | ✅（反向）    | 中           | 简单       |
| **TTL** | 存活时间     | ✖️            | ✅            | 中           | 简单       |
| **2Q**  | 时间 + 频率  | ✅（间接）    | ✅            | 强           | 中等偏上   |

## 缓存策略

| 应用类型       | 推荐策略      | 理由                 |
| -------------- | ------------- | -------------------- |
| 操作系统页面   | LRU / 2Q      | 局部性原则 +         |
| 抗污染         |               |                      |
| 高频访问接口   | LFU           | 长期热数据保留       |
| 临时数据缓存   | TTL           | 简单易控过期时间     |
| 突发扫描请求   | 2Q            | 抵抗瞬时污染         |
| 分析性查询系统 | MRU / TTL     | 最近数据不再重要     |
| 分布式缓存系统 | TTL + LRU/LFU | 结合多种机制效果最佳 |